<!DOCTYPE html>

<html lang="ru">

<head>

  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />


  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js">

// –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
async function updateProductTitle(productId, newTitle) {
  try {
    await db.collection('products').doc(productId).update({ title: newTitle });
    Swal.fire('–£—Å–ø–µ—Ö!', '–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ', 'success');
    loadProducts();
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –Ω–∞–∑–≤–∞–Ω–∏—è:', error);
    Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ', 'error');
  }
}

// –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä
async function toggleProductBlock(productId, currentStatus) {
  try {
    await db.collection('products').doc(productId).update({ blocked: !currentStatus });
    Swal.fire('–£—Å–ø–µ—Ö!', !currentStatus ? '–¢–æ–≤–∞—Ä –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω' : '–¢–æ–≤–∞—Ä —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω', 'success');
    loadProducts();
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç–∞—Ç—É—Å–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:', error);
    Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏', 'error');
  }
}

</script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js">

// –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
async function updateProductTitle(productId, newTitle) {
  try {
    await db.collection('products').doc(productId).update({ title: newTitle });
    Swal.fire('–£—Å–ø–µ—Ö!', '–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ', 'success');
    loadProducts();
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –Ω–∞–∑–≤–∞–Ω–∏—è:', error);
    Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ', 'error');
  }
}

// –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä
async function toggleProductBlock(productId, currentStatus) {
  try {
    await db.collection('products').doc(productId).update({ blocked: !currentStatus });
    Swal.fire('–£—Å–ø–µ—Ö!', !currentStatus ? '–¢–æ–≤–∞—Ä –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω' : '–¢–æ–≤–∞—Ä —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω', 'success');
    loadProducts();
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç–∞—Ç—É—Å–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:', error);
    Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏', 'error');
  }
}

</script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js">

// –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
async function updateProductTitle(productId, newTitle) {
  try {
    await db.collection('products').doc(productId).update({ title: newTitle });
    Swal.fire('–£—Å–ø–µ—Ö!', '–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ', 'success');
    loadProducts();
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –Ω–∞–∑–≤–∞–Ω–∏—è:', error);
    Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ', 'error');
  }
}

// –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä
async function toggleProductBlock(productId, currentStatus) {
  try {
    await db.collection('products').doc(productId).update({ blocked: !currentStatus });
    Swal.fire('–£—Å–ø–µ—Ö!', !currentStatus ? '–¢–æ–≤–∞—Ä –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω' : '–¢–æ–≤–∞—Ä —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω', 'success');
    loadProducts();
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç–∞—Ç—É—Å–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:', error);
    Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏', 'error');
  }
}

</script>

  

  <style>
    






@media (max-width: 600px) {
  .admin-product-input {
    font-size: 1.1rem;
    padding: 12px 10px;
    width: 100% !important;
    min-width: 0;
    margin: 6px 0;
    border-radius: 12px;
  }
  .admin-product-btn {
    font-size: 1.1rem;
    padding: 14px 0;
    width: 100%;
    margin: 6px 0;
    border-radius: 12px;
    min-width: 0;
    display: block;
  }
  .admin-product-row {
    display: flex;
    flex-direction: column;
    gap: 6px;
    border-radius: 14px;
    box-shadow: 0 2px 12px #007bff22;
    padding: 8px 0;
  }
  td, th {
    font-size: 1rem;
    padding: 8px 4px;
  }
}
/* --- –ö—Ä–∞—Å–∏–≤—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –∞–¥–º–∏–Ω–∞ --- */
.admin-product-input {
  border: 2px solid #90bfff;
  border-radius: 8px;
  background: #fafdff;
  padding: 7px 10px;
  font-size: 1rem;
  margin: 2px 0;
  transition: border 0.2s, box-shadow 0.2s;
  box-shadow: 0 1px 6px #007bff11;
}
.admin-product-input:focus {
  border: 2px solid #007bff;
  box-shadow: 0 2px 12px #007bff33;
  background: #eaf4ff;
}
.admin-product-btn {
  background: linear-gradient(90deg,#007bff 60%,#00c6ff 100%);
  color: #fff;
  border: none;
  border-radius: 8px;
  padding: 8px 18px;
  font-size: 1rem;
  margin: 2px 2px;
  cursor: pointer;
  box-shadow: 0 2px 8px #007bff22;
  transition: background 0.2s, box-shadow 0.2s, transform 0.1s;
}
.admin-product-btn:hover {
  background: linear-gradient(90deg,#0056b3 60%,#00aaff 100%);
  box-shadow: 0 4px 16px #007bff33;
  transform: scale(1.04);
}
.admin-product-row {
  background: #f0f7ff;
  border-radius: 10px;
  box-shadow: 0 2px 8px #007bff11;
}
.order-form #cartList {
  background: #fafdff;
  border: 2px solid #90bfff;
  border-radius: 12px;
  box-shadow: 0 2px 8px #007bff11;
  padding: 8px 0 8px 0;
  position: relative;
}
.cart-scroll-hint {
  text-align: center;
  color: #007bff;
  font-size: 13px;
  margin-bottom: 4px;
  font-style: italic;
  letter-spacing: 0.5px;
}
/* –ê–Ω–∏–º–∞—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã */
.cart-item-removing {
  opacity: 0;
  max-height: 0 !important;
  margin: 0 !important;
  padding: 0 !important;
  transition: opacity 0.3s, max-height 0.3s, margin 0.3s, padding 0.3s;
  overflow: hidden;
}
.order-form #cartList {
  max-height: 220px;
  overflow-y: auto;
  margin-bottom: 10px;
}
@media (max-width: 600px) {
  .order-form #cartList {
    max-height: 320px;
  }
}
.cart-item .delete-item {
  background: #dc3545 !important;
  color: #fff !important;
  border: none;
  font-size: 20px;
  width: 32px;
  height: 32px;
  border-radius: 50%;
  margin-left: 8px;
  transition: background 0.2s;
}
.cart-item .delete-item:hover {
  background: #b71c1c !important;
}
@media (max-width: 600px) {
  .cart-item .delete-item {
    display: block;
    width: 100% !important;
    height: 44px !important;
    font-size: 2rem;
    margin: 8px 0 0 0;
    border-radius: 12px;
  }
}


.search-sort-row {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
  width: 100%;
  max-width: 600px;
  }
/* --- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –∫–∞–∫ –Ω–∞ https://kara-ssyy-oomat.github.io/meloch/ --- */
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: 'Arial', sans-serif;
  background: #FFF9E5 url('—Ñ–æ–Ω.avif') center center/cover no-repeat;
  color: #333;
}
h1, h2 {
  text-align: center;
  margin-bottom: 20px;
  animation: fadeIn 1s ease forwards;
  color: #fff;
}
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 8px;
}
.search-sort-row {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
  width: 100%;
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
}
.search-sort-row input,
.search-sort-row select,
.search-sort-row .other-site-btn {
  flex: 1 1 0;
  width: 100%;
  max-width: none;
  box-sizing: border-box;
  margin: 10px auto;
}
.other-site-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  background: #007bff;
  color: #fff !important;
  text-align: center;
  padding: 10px 0;
  border-radius: 5px;
  text-decoration: none;
  transition: background 0.2s;
  font-weight: bold;
  height: 100%;
}
.other-site-btn:hover {
  background: #0056b3;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 20px;
  background: white;
  box-shadow: 0 0 10px #ccc;
  overflow-x: auto;
  display: block;
  border-radius: 12px;
}
thead th {
  position: sticky;
  top: 0;
  background: #00fff7;
  z-index: 2;
}
th, td {
  padding: 10px;
  border: 1px solid #ddd;
  text-align: center;
  font-size: 15px;
}
th:nth-child(5), td:nth-child(5) {
  min-width: 90px;
  width: 80px;
}
.product-img {
  max-width: 60px;
  height: auto;
  transition: transform 0.2s, box-shadow 0.2s;
  border-radius: 8px;
}
.product-img:hover {
  transform: scale(1.08);
  box-shadow: 0 4px 16px #0002;
}
.cart-item {
  display: flex;
  align-items: center;
  gap: 0;
  margin-bottom: 8px;
  padding: 4px 0;
  border-bottom: 1px solid #f0f0f0;
}
.cart-item-compact {
  gap: 0;
  padding: 2px 0;
  min-height: 40px;
  align-items: center;
}
.cart-mini-img {
  width: 32px;
  height: 32px;
  object-fit: cover;
  border-radius: 6px;
  margin-right: 8px;
  flex-shrink: 0;
  background: #f8f8f8;
  box-shadow: 0 1px 4px #0001;
  display: block;
}
.cart-title {
  flex: 1 1 auto;
  min-width: 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.cart-qty, .cart-price, .cart-sum {
  margin: 0 8px;
  white-space: nowrap;
}
.cart-sum {
  font-weight: bold;
}
.cart-item-compact {
  gap: 0;
  padding: 2px 0;
  min-height: 36px;
}
.cart-mini-img {
  width: 32px;
  height: 32px;
  object-fit: cover;
  border-radius: 6px;
  margin-right: 8px;
  flex-shrink: 0;
  background: #f8f8f8;
  box-shadow: 0 1px 4px #0001;
}
.cart-title {
  flex: 1 1 auto;
  min-width: 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.cart-qty, .cart-price, .cart-sum {
  margin: 0 8px;
  white-space: nowrap;
}
.cart-sum {
  font-weight: bold;
}
.order-form, #orderHistory {
  background: #cce4ff;
  padding: 22px 18px 22px 18px;
  border-radius: 16px;
  box-shadow: 0 4px 24px #007bff22, 0 1.5px 0 #007bff inset;
  margin-top: 20px;
}
input, select, button, textarea {
  font-size: 1rem;
  padding: 10px;
  margin: 10px auto;
  width: 100%;
  max-width: 400px;
  display: block;
  border-radius: 5px;
  border: 1px solid #ccc;
}
button, .other-site-btn {
  border-radius: 8px;
  box-shadow: 0 2px 8px #0001;
  transition: background 0.2s, color 0.2s;
}
button:active {
  transform: scale(0.97);
}
button {

  background: #28a745;
  color: white;
  border: none;
  cursor: pointer;
  transition: 0.3s;
}

  button:hover { background: #218838; }
.delete-order {
  background: #dc3545;
  color: white;
  border: none;
  padding: 8px 12px;
  margin-bottom: 6px;
  margin-top: 10px;
  border-radius: 5px;
  cursor: pointer;
  transition: background 0.3s ease;
}
  /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –≤—Å—ë –Ω–∏–∂–µ –æ–±—ë—Ä–Ω—É—Ç–æ –≤ .cart-mini-img */

.cart-mini-img {
  border-radius: 6px;
  margin-right: 8px;
  flex-shrink: 0;
  background: #fff;
  box-shadow: 0 1px 4px #007bff33;
  display: block;
  border: 2px solid #007bff;
}

button.delete-item:hover {
  color: #c82333;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}
@keyframes addToCart {
  0% { transform: scale(1); background-color: #28a745; }
  50% { transform: scale(1.2); background-color: #218838; }
  100% { transform: scale(1); background-color: #28a745; }
}
.animate-add {
  animation: addToCart 0.5s ease;
}
@media (max-width: 600px) {
  body {
    font-size: 1.05rem;
    padding-bottom: 60px;
  }
  .container {
    max-width: 100vw;
    padding: 0 2vw;
  }
  .order-form, #orderHistory {
    padding: 10px 2vw;
    margin-top: 10px;
    box-shadow: 0 2px 8px #0001;
    border-radius: 10px;
  }
  .order-form input, .order-form button {
    width: 100%;
    min-height: 44px;
    font-size: 1rem;
    margin-bottom: 10px;
  }
  .search-sort-row {
    flex-direction: column;
    gap: 0;
    max-width: 100vw;
    padding: 0 2vw;
  }
  .other-site-btn {
    font-size: 1rem;
    padding: 12px 0;
    margin-top: 8px;
    border-radius: 8px;
  }
  table {
    display: block;
    width: 100vw;
    overflow-x: auto;
    border-radius: 10px;
    box-shadow: 0 2px 8px #0001;
  }
  thead, tbody, tr {
    display: table;
    width: 100%;
    table-layout: fixed;
  }
  th, td {
    font-size: 13px;
    padding: 7px 4px;
    min-width: 70px;
    word-break: break-word;
  }
  th:nth-child(2), td:nth-child(2) {
    min-width: 60px;
    max-width: 70px;
  }
  .product-img {
    max-width: 70px;
    min-width: 44px;
    width: 100%;
    height: auto;
    display: block;
    margin: 0 auto 6px auto;
    border-radius: 8px;
    box-shadow: 0 2px 8px #007bff22;
    background: #fff;
    object-fit: contain;
  }
  .cart-item {
    flex-direction: column;
    align-items: flex-start;
    gap: 4px;
    font-size: 0.98rem;
  }
  .cart-summary {
    font-size: 1.1rem;
    margin: 8px 0;
  }
  #cartList div {
    font-size: 0.98rem;
    padding: 4px 0;
  }
  button, .order-form button, .other-site-btn {
    min-height: 44px;
    font-size: 1rem;
    padding: 10px 0;
  }
  .scroll-buttons {
    right: 10px;
    bottom: 10px;
    gap: 6px;
  }
  .scroll-buttons button {
    font-size: 18px;
    padding: 10px 14px;
    border-radius: 12px;
  }
  #previewInner {
    width: 96vw !important;
    left: 2vw !important;
    transform: none !important;
    padding: 6vw 2vw !important;
  }
  #previewImg {
    max-width: 92vw !important;
    max-height: 60vh !important;
  }
  #toggleHistory, #logoutUser {
    width: 100%;
    min-height: 44px;
    font-size: 1rem;
    margin: 8px 0;
  }
  #orderHistory h2 {
    font-size: 1.1rem;
    margin-bottom: 10px;
  }
  #historyList li {
  font-size: 0.98rem;
  margin-bottom: 10px;
  padding: 8px 4px;
  border-radius: 8px;
  box-shadow: 0 1px 4px #0001;
}
}

@keyframes addToCart {
  0% { transform: scale(1); background-color: #28a745; }
  50% { transform: scale(1.2); background-color: #218838; }
  100% { transform: scale(1); background-color: #28a745; }
}

    .animate-add {

      animation: addToCart 0.5s ease;

    }



    @media (max-width: 600px) {

      th, td { font-size: 12px; padding: 6px; }

      input, select, button, textarea { font-size: 0.9rem; padding: 8px; }

      .cart-summary { font-size: 1.2rem; }

      #cartList div { font-size: 0.9rem; }

      .order-form input, .order-form button { width: 90%; }

    }
    @media (max-width: 600px) {
  button.delete-item {
    width: 20px; /* –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é —à–∏—Ä–∏–Ω—É */
    height: 20px; /* –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤—ã—Å–æ—Ç—É */
    font-size: 12px; /* –£–º–µ–Ω—å—à–∞–µ–º —Ä–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞ */
    padding: 0; /* –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã */
  }
}

    @media (max-width: 600px) {
  th, td { font-size: 12px; padding: 6px; }
  input, select, button, textarea { font-size: 0.9rem; padding: 8px; }
  .cart-summary { font-size: 1.2rem; }
  #cartList div { font-size: 0.9rem; }
  .order-form input, .order-form button { width: 90%; }
  button.delete-item {
    width: 20px;
    height: 20px;
    font-size: 12px;
    padding: 0;
  }
}

  </style>
      



  <!-- SweetAlert2 -->

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11">

// –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
async function updateProductTitle(productId, newTitle) {
  try {
    await db.collection('products').doc(productId).update({ title: newTitle });
    Swal.fire('–£—Å–ø–µ—Ö!', '–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ', 'success');
    loadProducts();
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –Ω–∞–∑–≤–∞–Ω–∏—è:', error);
    Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ', 'error');
  }
}

// –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä
async function toggleProductBlock(productId, currentStatus) {
  try {
    await db.collection('products').doc(productId).update({ blocked: !currentStatus });
    Swal.fire('–£—Å–ø–µ—Ö!', !currentStatus ? '–¢–æ–≤–∞—Ä –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω' : '–¢–æ–≤–∞—Ä —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω', 'success');
    loadProducts();
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç–∞—Ç—É—Å–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:', error);
    Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏', 'error');
  }
}

</script>

</head>

<body>
  <!-- –ö–Ω–æ–ø–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã -->
  <button id="cartFloatBtn" style="position:fixed;left:20px;bottom:20px;z-index:9999;background:#007bff;color:#fff;border:none;border-radius:50%;width:56px;height:56px;box-shadow:0 2px 12px #007bff44;display:flex;align-items:center;justify-content:center;font-size:26px;cursor:pointer;transition:background 0.2s;">
    <span id="cartFloatCount" style="position:absolute;top:6px;right:8px;background:#dc3545;color:#fff;border-radius:50%;padding:2px 7px;font-size:14px;font-weight:bold;min-width:22px;text-align:center;">0</span>
    üõí
  </button>

  <!-- –ë–ª–æ–∫ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ñ–æ—Ç–æ -->
  <div id="previewBlock" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; z-index:1000; pointer-events:auto;">
    <div id="previewInner" style="position:absolute; top:10%; left:50%; transform:translateX(-50%); background:white; padding:20px; border-radius:10px; box-shadow:0 0 20px #0008;">
      <span id="closePreview" style="cursor:pointer; float:right; font-size:24px;">&times;</span>
      <img id="previewImg" src="" alt="–ü—Ä–æ—Å–º–æ—Ç—Ä" style="max-width:90vw; max-height:70vh; display:block; margin:auto;">
    </div>
  </div>
<!-- filepath: c:\Users\hp\Desktop\–Ω–æ–∂\index.html -->

  <h1>–ú–µ–ª–æ—á—å - –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</h1>



  <div class="search-sort-row">
    <input type="text" id="search" placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–∞..." />
    <select id="sort">
      <option value="">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ü–µ–Ω–µ</option>
      <option value="asc">–°–Ω–∞—á–∞–ª–∞ –¥–µ—à—ë–≤—ã–µ</option>
      <option value="desc">–°–Ω–∞—á–∞–ª–∞ –¥–æ—Ä–æ–≥–∏–µ</option>
    </select>
    <a href=" https://kara-ssyy-oomat.github.io/scoch/" target="_blank" class="other-site-btn">–û—Å–Ω–æ–≤–Ω–æ–π —Å–∞–π—Ç</a>

    <a href="https://kara-ssyy-oomat.github.io/noj/" target="_blank" class="other-site-btn">–î—Ä—É–≥–æ–π —Å–∞–π—Ç –¥–ª—è –Ω–æ–∂</a>
  </div>



  <table>

    <thead>
      <tr>
        <th>‚Ññ</th>
        <th>–§–æ—Ç–æ</th>
        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
        <th>–¶–µ–Ω–∞</th>
        <th>–ö–æ–ª-–≤–æ</th>
        <th>–î–æ–±–∞–≤–∏—Ç—å</th>
        <th id="managementHeader" style="display: none;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</th>
      </tr>
    </thead>

    <tbody id="productTable"></tbody>

  </table>



  <div class="order-form">

    <h2>–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</h2>

    <div id="cartList"></div>

    <div class="cart-summary">–ò—Ç–æ–≥–æ: <span id="totalSum">0</span> —Å</div>

    <button id="clearCart">–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É</button>

    <input type="text" id="name" placeholder="–í–∞—à–µ –∏–º—è" required />

    <input type="tel" id="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" required />

    <input type="text" id="address" placeholder="–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏" required />

    <button id="submitOrder">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</button>

  </div>

  <button id="logoutUser" style="margin:10px 0;">–í—ã–π—Ç–∏ –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è</button>

  <button id="toggleHistory">–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</button>

  <div id="orderHistory" style="display:none">

    <h2>–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</h2>

    <ul id="historyList"></ul>

  </div>

  <div id="adminAuth" style="margin:20px 0;">
    <h3>–í—Ö–æ–¥ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
    <input type="password" id="adminPassword" placeholder="–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞">
    <button id="loginAdmin">–í–æ–π—Ç–∏</button>
  </div>

  <div id="adminAddProduct" style="margin:20px 0; display: none;">
    <h3>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)</h3>
    <input type="text" id="newTitle" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞">
    <input type="number" id="newPrice" placeholder="–¶–µ–Ω–∞">
    <input type="number" id="newOptPrice" placeholder="–û–ø—Ç–æ–≤–∞—è —Ü–µ–Ω–∞">
    <input type="number" id="newOptQty" placeholder="–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–ª—è –æ–ø—Ç–∞">
    <input type="number" id="newMinQty" placeholder="–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–ª—è –ø–æ–∫—É–ø–∫–∏">
    <div style="display: flex; gap: 10px; margin: 10px 0; flex-wrap: wrap;">
      <input type="file" id="imageFile" accept="image/*" style="flex: 1;">
      <input type="file" id="galleryFile" accept="image/*" style="display: none;">
      <button id="openGallery" style="flex: 1;" onclick="document.getElementById('galleryFile').click()">–í—ã–±—Ä–∞—Ç—å –∏–∑ –≥–∞–ª–µ—Ä–µ–∏</button>
    </div>
    <input type="text" id="newImage" placeholder="URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏" style="display: block; margin-bottom: 5px;">
    <button id="previewUrlBtn" style="margin-bottom: 10px;">–ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –ø–æ URL</button>
    <div id="imagePreview" style="margin: 10px 0; display: none;">
      <img id="previewImg" src="" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä" style="max-width: 200px; max-height: 200px;">
    </div>
    <button id="addProductBtn">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
  </div>

  <div id="adminProductsBlock"></div>



  <script>
 let products = [];
 let isAdmin = false;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
const firebaseConfig = {
  apiKey: "AIzaSyDQtCFZDOoCha2nu1vDnEq-jnhk_EN3fCE",
  authDomain: "skotch-f1973.firebaseapp.com",
  projectId: "skotch-f1973",
  storageBucket: "skotch-f1973.firebasestorage.app",
  messagingSenderId: "1078241762705",
  appId: "1:1078241762705:web:6b1cba8b09864a84668e30",
  measurementId: "G-SJHYQQGHCP"
};

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase
try {
  if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
  }
  console.log('Firebase initialized successfully');
} catch (error) {
  console.error('Firebase initialization error:', error);
  Swal.fire('–û—à–∏–±–∫–∞', '–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase: ' + error.message, 'error');
}

const db = firebase.firestore();
const storage = firebase.storage();

// –ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
const ADMIN_PASSWORD = "2007";

// –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
async function loadProducts() {
  try {
    console.log('Loading products...');
    let snapshot;
    try {
      snapshot = await db.collection('products').orderBy('order').get();
    } catch (e) {
      // –ï—Å–ª–∏ –Ω–µ—Ç –ø–æ–ª—è order, –∑–∞–≥—Ä—É–∂–∞–µ–º –±–µ–∑ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
      snapshot = await db.collection('products').get();
    }
    products = [];
    snapshot.forEach(doc => {
      const data = doc.data();
      if (data.image) {
        data.image = fixImageUrl(data.image);
      }
      products.push({ id: doc.id, ...data });
    });
    // –ï—Å–ª–∏ –Ω–µ—Ç —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ order, —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
    if (!products.every(p => typeof p.order === 'number')) {
      products.sort((a, b) => (a.title || '').localeCompare(b.title || ''));
    } else {
      products.sort((a, b) => (a.order || 0) - (b.order || 0));
    }
    console.log('Products loaded:', products.length);
    renderProducts();
  } catch (error) {
    console.error('Error loading products:', error);
    Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ–≤–∞—Ä—ã: ' + error.message, 'error');
  }
}

// –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
function fixImageUrl(url) {
  if (!url) return 'no-image.png';
  
  // –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –∏–º—è —Ñ–∞–π–ª–∞ (–±–µ–∑ –ø—É—Ç–∏)
  if (!url.includes('/') && !url.startsWith('http')) {
    // –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ –ª–æ–∫–∞–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
    return './images/' + url;
  }
  
  return url;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ Firebase Storage
async function uploadImageToStorage(file) {
  try {
    console.log('Starting image upload...');
    const storageRef = storage.ref();
    const fileName = `${Date.now()}_${file.name}`;
    const fileRef = storageRef.child(`products/${fileName}`);
    
    console.log('Uploading file:', fileName);
    const snapshot = await fileRef.put(file);
    console.log('Upload completed:', snapshot);
    
    const downloadURL = await fileRef.getDownloadURL();
    console.log('Download URL:', downloadURL);
    
    return downloadURL;
  } catch (error) {
    console.error('Error uploading image:', error);
    throw error;
  }
}


// === Cloudinary upload helper ===
async function uploadToCloudinary(file) {
  const cloudName = 'dya0j6wgv'; // ‚Üê –í–°–¢–ê–í–¨ –°–Æ–î–ê –ò–ó Cloudinary // ‚Üê –∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π cloud_name (–ø–æ–∑–∂–µ)
  const uploadPreset = 'mystore_upload';

  const url = `https://api.cloudinary.com/v1_1/${cloudName}/image/upload`;
  const formData = new FormData();
  formData.append('file', file);
  formData.append('upload_preset', uploadPreset);

  const res = await fetch(url, {
    method: 'POST',
    body: formData
  });

  const data = await res.json();
  if (data.secure_url) {
    return data.secure_url;
  } else {
    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ Cloudinary');
  }
}


// === Imgur upload helper ===
async function uploadToImgur(file) {
  const clientId = 'YOUR_IMGUR_CLIENT_ID'; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–π Client-ID —Å https://api.imgur.com/oauth2/addclient
  const formData = new FormData();
  formData.append('image', file);
  const res = await fetch('https://api.imgur.com/3/image', {
    method: 'POST',
    headers: { Authorization: 'Client-ID ' + clientId },
    body: formData
  });
  const data = await res.json();
  if (data.success && data.data && data.data.link) {
    return data.data.link;
  } else {
    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ Imgur');
  }
}

// === Postimages upload helper ===
async function uploadToPostimages(file) {
  const formData = new FormData();
  formData.append('file', file);
  formData.append('upload_session', '');
  formData.append('numfiles', 1);
  formData.append('optsize', 0);
  formData.append('expire', 0);
  const res = await fetch('https://api.postimages.org/1/upload', {
    method: 'POST',
    body: formData
  });
  const data = await res.json();
  if (data && data.direct_link) {
    return data.direct_link;
  } else {
    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ Postimages');
  }
}



// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞—á
// –¢–µ–ø–µ—Ä—å —Ñ–æ—Ç–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –Ω–∞ ImageBB, —Å—Å—ã–ª–∫–∞ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ newImage

document.getElementById('imageFile').addEventListener('change', async function(e) {
  const file = e.target.files[0];
  const addBtn = document.getElementById('addProductBtn');
  if (file) {
    addBtn.disabled = true;
    document.getElementById('newImage').value = '';
    const reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById('previewImg').src = e.target.result;
      document.getElementById('imagePreview').style.display = 'block';
    };
    reader.readAsDataURL(file);
    try {
      // const url = await uploadImageToStorage(file); // –û—Ç–∫–ª—é—á–∞–µ–º Firebase Storage
      // const url = await uploadToImgur(file); // –û—Ç–∫–ª—é—á–∞–µ–º Imgur
      // const url = await uploadToPostimages(file); // –û—Ç–∫–ª—é—á–∞–µ–º Postimages
      const url = await uploadToCloudinary(file);
      document.getElementById('newImage').value = url;
      addBtn.disabled = false;
      Swal.fire('–§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –Ω–∞ ImageBB!', '', 'success');
      console.log('Image uploaded to ImageBB and url set to newImage input:', url);
    } catch (err) {
      Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ ImageBB', 'error');
      addBtn.disabled = false;
    }
  }
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ –∏–∑ –≥–∞–ª–µ—Ä–µ–∏
// –¢–µ–ø–µ—Ä—å —Ñ–æ—Ç–æ –∏–∑ –≥–∞–ª–µ—Ä–µ–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –Ω–∞ ImageBB

document.getElementById('galleryFile').addEventListener('change', async function(e) {
  const file = e.target.files[0];
  const addBtn = document.getElementById('addProductBtn');
  if (file) {
    addBtn.disabled = true;
    document.getElementById('newImage').value = '';
    const reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById('previewImg').src = e.target.result;
      document.getElementById('imagePreview').style.display = 'block';
    };
    reader.readAsDataURL(file);
    try {
      // const url = await uploadImageToStorage(file); // –û—Ç–∫–ª—é—á–∞–µ–º Firebase Storage
      // const url = await uploadToImgur(file); // –û—Ç–∫–ª—é—á–∞–µ–º Imgur
      // const url = await uploadToPostimages(file); // –û—Ç–∫–ª—é—á–∞–µ–º Postimages
      const url = await uploadToCloudinary(file);
      document.getElementById('newImage').value = url;
      addBtn.disabled = false;
      Swal.fire('–§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –Ω–∞ ImageBB!', '', 'success');
      console.log('Image from gallery uploaded to ImageBB and url set to newImage input:', url);
    } catch (err) {
      Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ ImageBB', 'error');
      addBtn.disabled = false;
    }
  }
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
// –¢–µ–ø–µ—Ä—å –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ URL

document.getElementById('addProductBtn').addEventListener('click', async function() {
  try {
    console.log('Add product button clicked');
    const title = document.getElementById('newTitle').value.trim();
    const price = +document.getElementById('newPrice').value;
    const optPrice = +document.getElementById('newOptPrice').value;
    const optQty = +document.getElementById('newOptQty').value;
    const minQty = +document.getElementById('newMinQty').value;
    const urlInput = document.getElementById('newImage').value.trim();
    let imageUrl = '';
    if (urlInput) {
      imageUrl = urlInput;
      console.log('Using manual url:', imageUrl);
    } else {
      imageUrl = document.getElementById('newImage').value.trim();
      if (!imageUrl) {
        Swal.fire('–û—à–∏–±–∫–∞', '–£–∫–∞–∂–∏—Ç–µ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª!', 'warning');
        return;
      }
    }

    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if (!title) {
      Swal.fire('–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞', 'warning');
      return;
    }
    if (!price || price <= 0) {
      Swal.fire('–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É', 'warning');
      return;
    }

    // --- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ---
    const addBtn = document.getElementById('addProductBtn');
    addBtn.disabled = true;
    addBtn.textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è...';
    const isValidImage = await checkImage(imageUrl);
    if (!isValidImage) {
      addBtn.disabled = false;
      addBtn.textContent = '–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä';
      Swal.fire('–û—à–∏–±–∫–∞', '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Å—ã–ª–∫—É –∏–ª–∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π —Ñ–∞–π–ª/URL.', 'error');
      return;
    }
    addBtn.textContent = '–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä';
    addBtn.disabled = false;
    // --- –∫–æ–Ω–µ—Ü –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ ---

    // –ù–∞—Ö–æ–¥–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π order —Å—Ä–µ–¥–∏ —Ç–æ–≤–∞—Ä–æ–≤
    let maxOrder = 0;
    products.forEach(p => {
      if (typeof p.order === 'number' && p.order > maxOrder) maxOrder = p.order;
    });

    const productData = { 
      title, 
      price, 
      optPrice: optPrice > 0 ? optPrice : null,
      optQty: optQty > 0 ? optQty : null,
      minQty: minQty > 0 ? minQty : 1,
      image: imageUrl,
      order: maxOrder + 1 
    };
    
    console.log('Adding product to Firestore:', productData);
    const docRef = await db.collection('products').add(productData);
    console.log('Product added with ID:', docRef.id);
    await loadProducts();
    renderProducts();
    Swal.fire('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω!', '', 'success');
    await loadProducts();
    // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
    document.getElementById('newImage').value = '';
    document.getElementById('newTitle').value = '';
    document.getElementById('newPrice').value = '';
    document.getElementById('newOptPrice').value = '';
    document.getElementById('newOptQty').value = '';
    document.getElementById('newMinQty').value = '';
    document.getElementById('imageFile').value = '';
    document.getElementById('imagePreview').style.display = 'none';
  } catch (error) {
    console.error('Error details:', error);
    document.getElementById('addProductBtn').disabled = false;
    document.getElementById('addProductBtn').textContent = '–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä';
    Swal.fire('–û—à–∏–±–∫–∞', `–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä: ${error.message}`, 'error');
  }
});

// === –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ–Ω–∞ —Å–∞–π—Ç–∞: –µ—Å–ª–∏ —Ñ–∞–π–ª —Ñ–æ–Ω.avif –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ–Ω ===
(function fixBackground() {
  const img = new window.Image();
  img.onload = function() { /* –≤—Å—ë –æ–∫ */ };
  img.onerror = function() {
    document.body.style.backgroundImage = 'none';
    document.body.style.background = '#f4f4f4';
  };
  img.src = '—Ñ–æ–Ω.av–∏—Ñ';
})();

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã
const cart = JSON.parse(localStorage.getItem('cart')) || [];

const productTable = document.getElementById('productTable');
const search = document.getElementById('search');
const sort = document.getElementById('sort');
const cartList = document.getElementById('cartList');
const totalSum = document.getElementById('totalSum');


// –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ localStorage
const userData = JSON.parse(localStorage.getItem('userData') || '{}');
if (userData.name) document.getElementById('name').value = userData.name;
if (userData.phone) document.getElementById('phone').value = userData.phone;
if (userData.address) document.getElementById('address').value = userData.address;

function addToCart(id, title, price, image, btn) {
  const row = btn.parentElement.parentElement;
  const qtyInput = row.querySelector('input');
  const qty = +qtyInput.value;

  const product = products.find(p => p.id === id);

  if (qty < (product.minQty || 1)) {
    Swal.fire('–û—à–∏–±–∫–∞', `–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–ª—è –ø–æ–∫—É–ø–∫–∏: ${product.minQty || 1}`, 'warning');
    qtyInput.value = product.minQty || 1;
    return;
  }

  // –°—á–∏—Ç–∞–µ–º –∏—Ç–æ–≥–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç—Ç–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω–µ
  const index = cart.findIndex(item => item.id === id);
  let totalQty = qty;
  if (index !== -1) totalQty += cart[index].qty;

  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–µ–Ω—É: –µ—Å–ª–∏ –æ–ø—Ç, —Ç–æ –æ–ø—Ç–æ–≤–∞—è —Ü–µ–Ω–∞
  let finalPrice = price;
  if (product.optQty && totalQty >= product.optQty && product.optPrice) {
    finalPrice = product.optPrice;
  }

  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ
  if (index !== -1) {
    cart[index].qty += qty;
cart[index].price = (product.optQty && cart[index].qty >= product.optQty && product.optPrice)
    ? product.optPrice
    : product.price;

  } else {
    cart.push({ id, title, price: finalPrice, qty, image });
  }

  updateCart();

  btn.classList.add('animate-add');
  setTimeout(() => btn.classList.remove('animate-add'), 500);

  Swal.fire({
    title: '–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!',
    text: `${title} √ó ${qty} –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≤–∞—à—É –∫–æ—Ä–∑–∏–Ω—É.`,
    icon: 'success',
    confirmButtonText: '–û–∫',
    position: 'bottom',
    showConfirmButton: true,
    timer: 1500,
    padding: '10px',
    toast: true
  });

  localStorage.setItem('cart', JSON.stringify(cart)); 
}

function updateCart() {
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –æ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ, –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä–æ–≤ –±–æ–ª—å—à–µ 4
  let scrollHint = document.getElementById('cartScrollHint');
  if (!scrollHint) {
    scrollHint = document.createElement('div');
    scrollHint.id = 'cartScrollHint';
    scrollHint.className = 'cart-scroll-hint';
    cartList.parentNode.insertBefore(scrollHint, cartList);
  }
  if (cart.length > 4) {
    scrollHint.textContent = '–ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ ‚Üì';
    scrollHint.style.display = '';
  } else {
    scrollHint.style.display = 'none';
  }
  cartList.innerHTML = '';

  let total = 0;

  cart.forEach((item, i) => {
    // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —Ü–µ–Ω—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω–µ
    const product = products.find(p => p.id === item.id);
    if (product) {
    if (product.optQty && item.qty >= product.optQty && product.optPrice) {
    item.price = product.optPrice;
} else {
    item.price = product.price;
}

    }
    total += item.qty * item.price;

    // –ú–∏–Ω–∏-—Ñ–æ—Ç–æ (–µ—Å–ª–∏ –µ—Å—Ç—å)
    const imgSrc = (product && product.image) ? product.image : 'no-image.png';
    const div = document.createElement('div');
    div.classList.add('cart-item', 'cart-item-compact');
    div.innerHTML = `
      <img src="${imgSrc}" alt="" class="cart-mini-img" style="cursor:pointer;" onclick="showPreview('${imgSrc}')">
      <div class="cart-info-row" style="display:flex;align-items:center;flex:1 1 auto;gap:8px;min-width:0;">
        <span class="cart-title" style="flex:1 1 0;min-width:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${item.title}</span>
        <span class="cart-qty" style="white-space:nowrap;">√ó${item.qty}</span>
        <span class="cart-price" style="white-space:nowrap;">${item.price}c</span>
        <span class="cart-sum" style="white-space:nowrap;font-weight:bold;">${item.qty * item.price}c</span>
      </div>
      <button class="delete-item" onclick="removeFromCart(${i})">&times;</button>
    `;
    cartList.appendChild(div);
  });

  totalSum.textContent = total;

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ—Ç—É –∫–æ—Ä–∑–∏–Ω—ã
  const clearCartButton = document.getElementById('clearCart');
  if (cart.length === 0) {
    clearCartButton.style.display = 'none';
  } else {
    clearCartButton.style.display = 'block';
  }

  localStorage.setItem('cart', JSON.stringify(cart));
}

function removeFromCart(i) {
  // –ê–Ω–∏–º–∞—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è
  const cartList = document.getElementById('cartList');
  const itemDiv = cartList.children[i];
  if (itemDiv) {
    itemDiv.classList.add('cart-item-removing');
    setTimeout(() => {
      cart.splice(i, 1);
      updateCart();
    }, 300);
  } else {
    cart.splice(i, 1);
    updateCart();
  }
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –æ—á–∏—Å—Ç–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã
document.getElementById('clearCart').onclick = () => {
  cart.length = 0;
  updateCart();
  localStorage.removeItem('cart');
  Swal.fire('–ö–æ—Ä–∑–∏–Ω–∞ –æ—á–∏—â–µ–Ω–∞!', '', 'success');
};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
  console.log('DOM loaded, initializing...');
  try {
    loadProducts();
    updateCart(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã
    // –ï—Å–ª–∏ —É–∂–µ –±—ã–ª –≤—Ö–æ–¥ –∫–∞–∫ –∞–¥–º–∏–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è), –ø–æ–∫–∞–∑–∞—Ç—å –ø–∞–Ω–µ–ª—å
    if (isAdmin) document.getElementById('adminPanel').style.display = '';
  } catch (error) {
    console.error('Error during initialization:', error);
    Swal.fire('–û—à–∏–±–∫–∞', '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: ' + error.message, 'error');
  }
});

document.getElementById('submitOrder').onclick = async () => {
  const name = document.getElementById('name').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const address = document.getElementById('address').value.trim();

  if (!name || !phone || !address || cart.length === 0) {
    Swal.fire('–û—à–∏–±–∫–∞', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∏ –¥–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã', 'warning');
    return;
  }

  try {
    const items = cart.map(i => `${i.title} ‚Äî ${i.qty}√ó${i.price}c=${i.qty * i.price}`).join('\n');
    const total = cart.reduce((sum, item) => sum + item.qty * item.price, 0);
    const currentTime = new Date().toLocaleString();

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–∫–∞–∑ –≤ Firebase
    await db.collection('orders').add({
      name,
      phone,
      address,
      items: cart.map(item => ({
        title: item.title,
        qty: item.qty,
        price: item.price
      })),
      total,
      time: currentTime,
      status: '–ù–æ–≤—ã–π'
    });

    const msg = `–ù–æ–≤—ã–π –∑–∞–∫–∞–∑:
–ò–º—è: ${name}
–¢–µ–ª–µ—Ñ–æ–Ω: ${phone}
–ê–¥—Ä–µ—Å: ${address}
–¢–æ–≤–∞—Ä—ã:
${items}

–ò—Ç–æ–≥–æ: ${total}c`;

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
    await fetch('https://api.telegram.org/bot7960727448:AAF0B2mizrzj7sjHP68n-1IcjLoNc6kwVkE/sendMessage', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ chat_id: '5567924440', text: msg })
    });
      await fetch('https://api.telegram.org/bot7960727448:AAF0B2mizrzj7sjHP68n-1IcjLoNc6kwVkE/sendMessage', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ chat_id: '246421345', text: msg })
    });

    Swal.fire('–£—Å–ø–µ—Ö!', '–í–∞—à –∑–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!', 'success');
    
    // –û—á–∏—â–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É
    cart.length = 0;
    updateCart();
    localStorage.removeItem('cart');
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    localStorage.setItem('userData', JSON.stringify({
      name,
      phone,
      address
    }));

    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
    document.getElementById('name').value = '';
    document.getElementById('phone').value = '';
    document.getElementById('address').value = '';

    // –û–±–Ω–æ–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—é –∑–∞–∫–∞–∑–æ–≤
    loadOrderHistory();

  } catch (error) {
    console.error('Error submitting order:', error);
    Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.', 'error');
  }
};

// –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–∫–∞–∑–æ–≤
async function loadOrderHistory() {
  try {
    const snapshot = await db.collection('orders')
      .orderBy('time', 'desc')
      .get();
    
    const historyList = document.getElementById('historyList');
    historyList.innerHTML = '';

    if (snapshot.empty) {
      historyList.innerHTML = '<li>–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ –ø—É—Å—Ç–∞.</li>';
      return;
    }

    snapshot.forEach(doc => {
      const order = doc.data();
      const li = document.createElement('li');
      li.style.marginBottom = '20px';
      li.style.padding = '10px';
      li.style.border = '1px solid #ddd';
      li.style.borderRadius = '5px';
      
      li.innerHTML = `
        <strong>–ó–∞–∫–∞–∑ –æ—Ç: ${order.time}</strong>
        <p>–ò–º—è: ${order.name}</p>
        <p>–¢–µ–ª–µ—Ñ–æ–Ω: ${order.phone}</p>
        <p>–ê–¥—Ä–µ—Å: ${order.address}</p>
        <p>–¢–æ–≤–∞—Ä—ã: ${order.items.map(i => `${i.title} √ó ${i.qty}`).join(', ')}</p>
        <p><strong>–ò—Ç–æ–≥–æ: ${order.total}c</strong></p>
        <p>–°—Ç–∞—Ç—É—Å: ${order.status}</p>
        ${isAdmin ? `
          <button class="delete-order" onclick="deleteOrder('${doc.id}')">–£–¥–∞–ª–∏—Ç—å</button>
          <select onchange="updateOrderStatus('${doc.id}', this.value)" style="margin-left: 10px;">
            <option value="–ù–æ–≤—ã–π" ${order.status === '–ù–æ–≤—ã–π' ? 'selected' : ''}>–ù–æ–≤—ã–π</option>
            <option value="–í –æ–±—Ä–∞–±–æ—Ç–∫–µ" ${order.status === '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ' ? 'selected' : ''}>–í –æ–±—Ä–∞–±–æ—Ç–∫–µ</option>
            <option value="–í—ã–ø–æ–ª–Ω–µ–Ω" ${order.status === '–í—ã–ø–æ–ª–Ω–µ–Ω' ? 'selected' : ''}>–í—ã–ø–æ–ª–Ω–µ–Ω</option>
            <option value="–û—Ç–º–µ–Ω–µ–Ω" ${order.status === '–û—Ç–º–µ–Ω–µ–Ω' ? 'selected' : ''}>–û—Ç–º–µ–Ω–µ–Ω</option>
          </select>
        ` : ''}
      `;
      historyList.appendChild(li);
    });
  } catch (error) {
    console.error('Error loading order history:', error);
    Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∑–∞–∫–∞–∑–æ–≤', 'error');
  }
}

// –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
async function deleteOrder(orderId) {
  try {
    const result = await Swal.fire({
      title: '–£–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑?',
      text: "–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#dc3545',
      cancelButtonColor: '#6c757d',
      confirmButtonText: '–î–∞, —É–¥–∞–ª–∏—Ç—å!',
      cancelButtonText: '–û—Ç–º–µ–Ω–∞'
    });

    if (result.isConfirmed) {
      await db.collection('orders').doc(orderId).delete();
      Swal.fire('–£–¥–∞–ª–µ–Ω–æ!', '–ó–∞–∫–∞–∑ –±—ã–ª —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω.', 'success');
      loadOrderHistory();
    }
  } catch (error) {
    console.error('Error deleting order:', error);
    Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑', 'error');
  }
}

// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞
async function updateOrderStatus(orderId, newStatus) {
  try {
    await db.collection('orders').doc(orderId).update({
      status: newStatus
    });
    loadOrderHistory();
  } catch (error) {
    console.error('Error updating order status:', error);
    Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞', 'error');
  }
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–∫–∞–∑–æ–≤
document.getElementById('toggleHistory').onclick = () => {
  const hist = document.getElementById('orderHistory');
  hist.style.display = hist.style.display === 'none' ? 'block' : 'none';
  
  if (hist.style.display === 'block') {
    loadOrderHistory();
  }
};

search.oninput = renderProducts;
sort.onchange = renderProducts;
renderProducts();
updateCart();

function showPreview(src) {
  document.getElementById('previewImg').src = src;
  document.getElementById('previewBlock').style.display = 'block';
  document.body.classList.add('modal-open');
}

document.getElementById('closePreview').onclick = function() {
  document.getElementById('previewBlock').style.display = 'none';
  document.body.classList.remove('modal-open');
};

document.getElementById('previewBlock').onclick = function(e) {
  if (e.target === this) {
    this.style.display = 'none';
    document.body.classList.remove('modal-open');
  }
};

function updatePriceInRow(input, price, optPrice, optQty) {
  const qty = +input.value;
  // –ò—â–µ–º –≤—Å—é —Å—Ç—Ä–æ–∫—É —Ç–æ–≤–∞—Ä–∞
  const row = input.closest('tr');
  const priceCell = row.querySelector('.price-cell span');
  if (!priceCell) return; // –∑–∞—â–∏—Ç–∞, –µ—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —è—á–µ–π–∫—É

  if (optQty && qty >= optQty && optPrice) {
    priceCell.textContent = optPrice;
  } else {
    priceCell.textContent = price;
  }
}


document.getElementById('logoutUser').onclick = () => {
  isAdmin = false;
  document.getElementById('adminAddProduct').style.display = 'none';
  document.getElementById('adminAuth').style.display = 'block';
  document.getElementById('managementHeader').style.display = 'none';
  document.getElementById('adminPassword').value = '';
  localStorage.removeItem('userData');
  document.getElementById('name').value = '';
  document.getElementById('phone').value = '';
  document.getElementById('address').value = '';
  Swal.fire('–í—ã –≤—ã—à–ª–∏ –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è');
  renderProducts();
  // –°–∫—Ä—ã–≤–∞–µ–º –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
  document.getElementById('adminPanel').style.display = 'none';
};

// –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
async function checkImage(url) {
  return new Promise((resolve) => {
    const img = new Image();
    img.onload = () => resolve(true);
    img.onerror = () => resolve(false);
    img.src = url;
  });
}

// –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤
function renderProducts() {
  console.log('Rendering products, admin status:', isAdmin);
  // –í–†–ï–ú–ï–ù–ù–û: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ image/title –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
  let filtered = isAdmin ? products : products.filter(p => !p.blocked); // .filter(p => p.title?.trim() && p.image?.trim());

  if (search.value) {
    filtered = filtered.filter(p => p.title && p.title.toLowerCase().includes(search.value.toLowerCase()));
  }

  if (sort.value) {
    filtered.sort((a, b) => sort.value === 'asc' ? a.price - b.price : b.price - a.price);
  }

  productTable.innerHTML = '';

  filtered.forEach((p, idx) => {
    console.log('Product in render:', p); // –õ–û–ì –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
    const isMobile = window.innerWidth <= 600;
    // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ñ–æ—Ç–æ: —É–≤–µ–ª–∏—á–∏–º —Ä–∞–∑–º–µ—Ä –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö, –¥–æ–±–∞–≤–∏–º —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç—Å—Ç—É–ø
    const containerSize = isMobile ? 'width:36px;height:36px;display:flex;align-items:center;justify-content:center;margin:2px 0;' : 'width:100px;height:100px;display:flex;align-items:center;justify-content:center;';
    // –§–æ—Ç–æ: —á—É—Ç—å –±–æ–ª—å—à–µ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö, —Å –æ—Ç—Å—Ç—É–ø–æ–º
    const imgSize = isMobile ? 'max-width:50px;max-height:50px;border-radius:5px;margin:2px 0;' : 'max-width:60px;max-height:60px;border-radius:8px;';
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${idx + 1}</td>
      <td>
        <div style="position: relative; ${containerSize}">
          <img src="${p.image}"
               class="product-img"
               alt="${p.title}"
               style="cursor:pointer; ${imgSize} object-fit: contain; display:block; margin:auto;"
               onclick="showPreview('${p.image}')"
               onerror="this.onerror=null; this.src='no-image.png'; this.style.opacity='0.5';"
               onload="this.style.opacity='1';"
          />
          <div class="image-loading" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: #f5f5f5;">
            <span style="color: #666;">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
          </div>
          ${isAdmin ? `<label style='position:absolute;bottom:2px;right:2px;cursor:pointer;background:#007bffcc;color:#fff;padding:2px 7px;border-radius:6px;font-size:13px;z-index:2;'>‚úé<input type='file' accept='image/*' style='display:none;' onchange='changeProductImage(event,"${p.id}")'></label>` : ''}
        </div>
      </td>
      
<td>
  ${
    isAdmin
      ? `<input type="text" value="${p.title}" onchange="updateProductTitle('${p.id}', this.value)" style="width: 100%; padding: 5px;" class="admin-product-input">`
      : (() => {
          const matches = p.title && p.title.match(/\\(.*?\\)/g);
          if (matches && matches.length) {
            const lastBracket = matches[matches.length - 1];
            const main = p.title.replace(lastBracket, '').trim();
            return `${main}<div style="font-size:12px;color:#888;">${lastBracket}</div>`;
          } else {
            return p.title;
          }
        })()
  }
</td>

      <td class="price-cell">
        ${isAdmin ? `
          <input type="number" value="${p.price}" 
            onchange="updateProductPrice('${p.id}', 'price', this.value)" 
            style="width: 80px; text-align: center;" class="admin-product-input">
        ` : `<span>${p.price}</span>`}c
      </td>
      <td>
        ${isAdmin ? `
          <input type="number" min="1" value="${p.minQty || 1}" 
            onchange="updateProductPrice('${p.id}', 'minQty', this.value)"
            style="width: 80px; text-align: center;" class="admin-product-input">
        ` : `
         <div class="qty-control" data-min="${p.minQty || 1}">
  <button type="button" onclick="changeQty(this, -1)">‚àí</button>
  <input type="text" value="${p.minQty || 1}" readonly />
  <button type="button" onclick="changeQty(this, 1)">+</button>
</div>

        `}
      </td>
      <td><button onclick="addToCart('${p.id}', '${p.title}', ${p.price}, '${p.image}', this)">–¥–æ–±–∞–≤–∏—Ç—å</button></td>
      ${isAdmin ? `
        <td class="admin-product-row">
          <button onclick="deleteProduct('${p.id}')" class="admin-product-btn" style="background: #dc3545;">–£–¥–∞–ª–∏—Ç—å</button>
          <button onclick="showMoveModal('${p.id}', 'up')" class="admin-product-btn" ${idx === 0 ? 'disabled' : ''}>‚Üë</button>
          <button onclick="showMoveModal('${p.id}', 'down')" class="admin-product-btn" ${idx === filtered.length - 1 ? 'disabled' : ''}>‚Üì</button>
          <button onclick="showEditWholesaleModal('${p.id}')" class="admin-product-btn">–û–ø—Ç</button>
          <button onclick="toggleProductBlock('${p.id}', ${p.blocked || false})" class="admin-product-btn" style="background:#ff9800; color:#222;">${p.blocked ? '–†–∞–∑–±–ª–æ–∫.' : '–ë–ª–æ–∫'}</button>
        </td>
      ` : ''}
    `;
    productTable.appendChild(row);

    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    const img = row.querySelector('img');
    const loadingDiv = row.querySelector('.image-loading');
    
    img.onload = function() {
      loadingDiv.style.display = 'none';
      this.style.opacity = '1';
    };
    
    img.onerror = function() {
      loadingDiv.style.display = 'none';
      this.src = 'no-image.png';
      this.style.opacity = '0.5';
    };
  });
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Ö–æ–¥–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
document.getElementById('loginAdmin').addEventListener('click', function() {
  const password = document.getElementById('adminPassword').value;
  console.log('Login attempt with password:', password);
  
  if (password === ADMIN_PASSWORD) {
    isAdmin = true;
    document.getElementById('adminAddProduct').style.display = 'block';
    document.getElementById('adminAuth').style.display = 'none';
    document.getElementById('managementHeader').style.display = 'table-cell';
    Swal.fire('–£—Å–ø–µ—Ö!', '–í—ã –≤–æ—à–ª–∏ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', 'success');
    renderProducts();
    loadOrderHistory();
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
      document.getElementById('adminPanel').style.display = '';
  } else {
    Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å', 'error');
  }
});

// –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
async function deleteProduct(productId) {
  try {
    const result = await Swal.fire({
      title: '–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?',
      text: "–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#dc3545',
      cancelButtonColor: '#6c757d',
      confirmButtonText: '–î–∞, —É–¥–∞–ª–∏—Ç—å!',
      cancelButtonText: '–û—Ç–º–µ–Ω–∞'
    });

    if (result.isConfirmed) {
      await db.collection('products').doc(productId).delete();
      Swal.fire('–£–¥–∞–ª–µ–Ω–æ!', '–¢–æ–≤–∞—Ä –±—ã–ª —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω.', 'success');
      loadProducts();
    }
  } catch (error) {
    console.error('Error deleting product:', error);
    Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä', 'error');
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤
const moveModal = document.createElement('div');
moveModal.id = 'moveModal';
moveModal.style.cssText = `
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  z-index: 1000;
`;
moveModal.innerHTML = `
  <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 10px; width: 90%; max-width: 500px;">
    <h3>–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ç–æ–≤–∞—Ä</h3>
    <div style="margin-bottom: 15px;">
      <p>–¢–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è: <span id="currentPosition">1</span></p>
      <label>–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –Ω–∞ –ø–æ–∑–∏—Ü–∏—é:</label>
      <input type="number" id="moveSteps" value="1" min="1" style="width: 100%; margin-top: 5px;">
    </div>
    <div style="display: flex; justify-content: space-between;">
      <button onclick="closeMoveModal()" style="background: #6c757d;">–û—Ç–º–µ–Ω–∞</button>
      <button onclick="moveProductMultiple()" style="background: #28a745;">–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å</button>
    </div>
  </div>
`;
document.body.appendChild(moveModal);

let currentMoveProductId = null;
let currentMoveDirection = null;

function showMoveModal(productId, direction) {
  currentMoveProductId = productId;
  currentMoveDirection = direction;
  const product = products.find(p => p.id === productId);
  const currentIndex = products.findIndex(p => p.id === productId);
  document.getElementById('currentPosition').textContent = currentIndex + 1;
  document.getElementById('moveSteps').value = currentIndex + 1;
  moveModal.style.display = 'block';
}

async function moveProductMultiple() {
  if (!currentMoveProductId) return;
  
  try {
    const targetPosition = parseInt(document.getElementById('moveSteps').value) || 1;
    const product = products.find(p => p.id === currentMoveProductId);
    const currentIndex = products.findIndex(p => p.id === currentMoveProductId);
    
    if (!product || currentIndex === -1) return;
    
    const newIndex = Math.max(0, Math.min(products.length - 1, targetPosition - 1));
    
    if (currentIndex === newIndex) {
      closeMoveModal();
      return;
    }
    
    const newProducts = [...products];
    const [movedProduct] = newProducts.splice(currentIndex, 1);
    newProducts.splice(newIndex, 0, movedProduct);
    
    const batch = db.batch();
    newProducts.forEach((p, index) => {
      const productRef = db.collection('products').doc(p.id);
      batch.update(productRef, { order: index });
    });
    
    await batch.commit();
    products = newProducts;
    renderProducts();
    closeMoveModal();
    Swal.fire('–£—Å–ø–µ—Ö!', '–¢–æ–≤–∞—Ä –ø–µ—Ä–µ–º–µ—â–µ–Ω', 'success');updatePriceInRow
  } catch (error) {
    console.error('Error moving product:', error);
    Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ç–æ–≤–∞—Ä', 'error');
    closeMoveModal();
  }
}

function closeMoveModal() {
  moveModal.style.display = 'none';
  currentMoveProductId = null;
  currentMoveDirection = null;
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–ø—Ç–æ–≤—ã—Ö —Ü–µ–Ω
const editWholesaleModal = document.createElement('div');
editWholesaleModal.id = 'editWholesaleModal';
editWholesaleModal.style.cssText = `
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  z-index: 1000;
`;
editWholesaleModal.innerHTML = `
  <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 10px; width: 90%; max-width: 500px;">
    <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø—Ç–æ–≤—ã—Ö —Ü–µ–Ω</h3>
    <div style="margin-bottom: 15px;">
      <label>–û–ø—Ç–æ–≤–∞—è —Ü–µ–Ω–∞:</label>
      <input type="number" id="editOptPrice" style="width: 100%; margin-top: 5px;">
    </div>
    <div style="margin-bottom: 15px;">
      <label>–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–ª—è –æ–ø—Ç–∞:</label>
      <input type="number" id="editOptQty" style="width: 100%; margin-top: 5px;">
    </div>
    <div style="display: flex; justify-content: space-between;">
      <button onclick="closeEditWholesaleModal()" style="background: #6c757d;">–û—Ç–º–µ–Ω–∞</button>
      <button onclick="saveWholesaleChanges()" style="background: #28a745;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  </div>
`;
document.body.appendChild(editWholesaleModal);

let currentEditingProductId = null;

function showEditWholesaleModal(productId) {
  const product = products.find(p => p.id === productId);
  if (!product) return;
  
  currentEditingProductId = productId;
  document.getElementById('editOptPrice').value = product.optPrice || '';
  document.getElementById('editOptQty').value = product.optQty || '';
  editWholesaleModal.style.display = 'block';
}

function closeEditWholesaleModal() {
  editWholesaleModal.style.display = 'none';
  currentEditingProductId = null;
}

async function saveWholesaleChanges() {
  if (!currentEditingProductId) return;
  
  try {
    const optPrice = document.getElementById('editOptPrice').value;
    const optQty = document.getElementById('editOptQty').value;
    
    await db.collection('products').doc(currentEditingProductId).update({
      optPrice: optPrice ? Number(optPrice) : null,
      optQty: optQty ? Number(optQty) : null
    });
    
    Swal.fire('–£—Å–ø–µ—Ö!', '–û–ø—Ç–æ–≤—ã–µ —Ü–µ–Ω—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
    closeEditWholesaleModal();
    loadProducts();
  } catch (error) {
    console.error('Error updating wholesale prices:', error);
    Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –æ–ø—Ç–æ–≤—ã–µ —Ü–µ–Ω—ã', 'error');
  }
}

// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω—ã —Ç–æ–≤–∞—Ä–∞
async function updateProductPrice(productId, field, value) {
  try {
    const updateData = {};
    updateData[field] = Number(value);
    
    await db.collection('products').doc(productId).update(updateData);
    Swal.fire('–£—Å–ø–µ—Ö!', '–¶–µ–Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞', 'success');
    loadProducts();
  } catch (error) {
    console.error('Error updating product price:', error);
    Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Ü–µ–Ω—É', 'error');
  }
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
editWholesaleModal.onclick = function(e) {
  if (e.target === this) {
    closeEditWholesaleModal();
  }
};

  

// –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
async function updateProductTitle(productId, newTitle) {
  try {
    await db.collection('products').doc(productId).update({ title: newTitle });
    Swal.fire('–£—Å–ø–µ—Ö!', '–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ', 'success');
    loadProducts();
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –Ω–∞–∑–≤–∞–Ω–∏—è:', error);
    Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ', 'error');
  }
}

// –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä
async function toggleProductBlock(productId, currentStatus) {
  try {
    await db.collection('products').doc(productId).update({ blocked: !currentStatus });
    Swal.fire('–£—Å–ø–µ—Ö!', !currentStatus ? '–¢–æ–≤–∞—Ä –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω' : '–¢–æ–≤–∞—Ä —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω', 'success');
    loadProducts();
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç–∞—Ç—É—Å–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:', error);
    Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏', 'error');
  }
}


function changeQty(btn, dir) {
  const container = btn.closest('.qty-control');
  const min = parseInt(container.dataset.min, 10) || 1;
  const input = container.querySelector('input');
  let val = parseInt(input.value, 10) || min;

  if (dir > 0) {
    val += min; // —à–∞–≥ –≤–≤–µ—Ä—Ö
  } else {
    val = Math.max(min, val - min); // —à–∞–≥ –≤–Ω–∏–∑
  }
  input.value = val;

  // –ù–∞—Ö–æ–¥–∏–º —Å—Ç—Ä–æ–∫—É —Ç–æ–≤–∞—Ä–∞
  const row = container.closest('tr');
  const productId = row.querySelector('button[onclick^="addToCart"]').getAttribute('onclick').match(/'([^']+)'/)[1];
  const product = products.find(p => p.id === productId);

  // ‚úÖ –û–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–Ω—É –≤ —è—á–µ–π–∫–µ
  updatePriceInRow(input, product.price, product.optPrice, product.optQty);
}


</script>

<!-- –ö–Ω–æ–ø–∫–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑ -->
  <div class="scroll-buttons" style="position:fixed;right:20px;bottom:20px;z-index:9999;display:flex;flex-direction:column;gap:10px;">
    <button id="scrollTopBtn" style="background:#007bff;color:#fff;border:none;padding:10px 14px;border-radius:12px;box-shadow:0 2px 8px #0001;cursor:pointer;font-size:18px;">‚ñ≤</button>
    <button id="scrollBottomBtn" style="background:#007bff;color:#fff;border:none;padding:10px 14px;border-radius:12px;box-shadow:0 2px 8px #0001;cursor:pointer;font-size:18px;">‚ñº</button>
  </div>
</body>
<script>
// --- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ ---
function toggleAdminPanel() {
  const panel = document.getElementById('adminPanel');
  if (panel.classList.contains('admin-panel-hidden')) {
    panel.classList.remove('admin-panel-hidden');
    document.getElementById('hideAdminPanelBtn').textContent = '–°–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å';
  } else {
    panel.classList.add('admin-panel-hidden');
    document.getElementById('hideAdminPanelBtn').textContent = '–ü–æ–∫–∞–∑–∞—Ç—å –ø–∞–Ω–µ–ª—å';
  }
}
// –°–º–µ–Ω–∞ —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞ –∞–¥–º–∏–Ω–æ–º
async function changeProductImage(e, productId) {
  const file = e.target.files[0];
  if (!file) return;
  try {
    // –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å uploadToCloudinary –∏–ª–∏ uploadImageToStorage
    const url = await uploadToCloudinary(file);
    await db.collection('products').doc(productId).update({ image: url });
    Swal.fire('–§–æ—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ!', '', 'success');
    loadProducts();
  } catch (err) {
    Swal.fire('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Ñ–æ—Ç–æ', 'error');
  }
}
// –ö–Ω–æ–ø–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã: –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –∫–æ—Ä–∑–∏–Ω–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
const cartFloatBtn = document.getElementById('cartFloatBtn');
const cartFloatCount = document.getElementById('cartFloatCount');
const orderForm = document.querySelector('.order-form');

cartFloatBtn.onclick = function() {
  if (orderForm) {
    orderForm.scrollIntoView({ behavior: 'smooth', block: 'center' });
  }
};

function updateCartFloatCount() {
  cartFloatCount.textContent = cart.length;
}

// –í—ã–∑–æ–≤–µ–º –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ—Ä–∑–∏–Ω—ã
const origUpdateCart = updateCart;
updateCart = function() {
  origUpdateCart.apply(this, arguments);
  updateCartFloatCount();
};
document.addEventListener('DOMContentLoaded', updateCartFloatCount);
// –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã –∫–Ω–æ–ø–æ–∫ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑
document.getElementById('scrollTopBtn').onclick = function() {
  window.scrollTo({ top: 0, behavior: 'smooth' });
};
document.getElementById('scrollBottomBtn').onclick = function() {
  window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
};
</script>
</html>
</body>
</html>